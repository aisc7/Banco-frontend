import{i as K,r as Q,j as e,c as u,u as X,T as t,B as o,d as Y,e as Z,f as $,g as ee,h as O,P as re,C as te}from"./index--atX_XUv.js";import{u as M}from"./Save-BjSFydXk.js";import{u as ae}from"./useI18n-nd37995H.js";import{P as oe,t as se}from"./PrestatarioForm-Dmevuc4a.js";import{A as w}from"./AppButton-DGApZOMm.js";import{D as le,a as ie,b as ne,c as de}from"./DialogTitle-DEFYoEti.js";import{G as A,C as V,a as F}from"./Grid-CQN_77nD.js";import{T as a}from"./TextField-BTw6FAe8.js";import{B as D}from"./Button-C1kfnTXj.js";var T={},ce=K;Object.defineProperty(T,"__esModule",{value:!0});var N=T.default=void 0,ue=ce(Q()),me=e;N=T.default=(0,ue.default)((0,me.jsx)("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2M9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9zm9 14H6V10h12zm-6-3c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2"}),"LockOutlined");const pe=({open:R,onClose:k})=>{var _,L,I;const[v,P]=u.useState(null),[s,x]=u.useState("options"),[m,y]=u.useState(""),[C,h]=u.useState(null),[i,p]=u.useState(""),[l,j]=u.useState(""),[n,b]=u.useState(""),[g,d]=u.useState(null),S=X(r=>r.enqueue),{register:W,handleSubmit:H,formState:{errors:f}}=M({defaultValues:{nombre:"",apellido:"",correo:"",area:""}}),E=()=>{P(null),x("options"),y(""),h(null),p(""),j(""),b(""),d(null),k()},z=r=>{P(r),y(""),h(null),x("secret")},G=()=>{m==="BasesDeDatos2"?(h(null),x("form")):h("Palabra secreta incorrecta")},U=async r=>{if(!i||!l||!n){d("Debes completar usuario y contraseña.");return}if(l!==n){d("Las contraseñas no coinciden.");return}d(null);const q=se(r,i);try{await Y({username:i,password:l,prestatario:q}),S("Prestatario y usuario registrados correctamente.","success"),E()}catch(c){const B=(c==null?void 0:c.message)??"Error al registrar el prestatario.";S(B,"error")}},J=r=>{if(!i||!l||!n){d("Debes completar usuario y contraseña.");return}if(l!==n){d("Las contraseñas no coinciden.");return}d(null);const q={nombre:r.nombre,apellido:r.apellido,cargo:r.area||void 0,salario:void 0,edad:void 0};Z({username:i,password:l,empleado:q}).then(c=>{console.log("Empleado y usuario creados en backend:",c),S("Empleado y usuario registrados correctamente.","success"),E()}).catch(c=>{const B=(c==null?void 0:c.message)??"Error al registrar el empleado.";S(B,"error")})};return e.jsxs(le,{open:R,onClose:E,maxWidth:"sm",fullWidth:!0,children:[e.jsx(ie,{children:"Opciones de registro"}),e.jsxs(ne,{children:[s==="options"&&e.jsxs(A,{container:!0,spacing:2,children:[e.jsx(A,{item:!0,xs:12,sm:6,children:e.jsx(V,{variant:"outlined",children:e.jsxs(F,{children:[e.jsx(t,{variant:"subtitle1",gutterBottom:!0,children:"Soy prestatario (cliente)"}),e.jsx(t,{variant:"body2",color:"text.secondary",mb:1,children:"Para registrarte como cliente, un funcionario de la entidad debe crear tu usuario en el sistema desde el módulo de prestatarios."}),e.jsx(w,{size:"small",onClick:()=>z("PRESTATARIO"),children:"Solicitar registro"})]})})}),e.jsx(A,{item:!0,xs:12,sm:6,children:e.jsx(V,{variant:"outlined",children:e.jsxs(F,{children:[e.jsx(t,{variant:"subtitle1",gutterBottom:!0,children:"Soy empleado"}),e.jsx(t,{variant:"body2",color:"text.secondary",mb:1,children:"Los usuarios de empleados se crean desde el módulo de Empleados por un administrador del sistema."}),e.jsx(w,{size:"small",onClick:()=>z("EMPLEADO"),children:"Solicitar registro"})]})})})]}),s==="secret"&&e.jsxs(o,{children:[e.jsx(t,{variant:"subtitle1",gutterBottom:!0,children:"Validación de registro"}),e.jsx(t,{variant:"body2",color:"text.secondary",mb:2,children:"Ingresa la Clave dada por administrador para continuar con el registro."}),e.jsxs(o,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(a,{label:"Clave",type:"password",fullWidth:!0,value:m,onChange:r=>y(r.target.value)}),C&&e.jsx(t,{variant:"body2",color:"error",children:C})]})]}),s==="form"&&v==="PRESTATARIO"&&e.jsxs(o,{children:[e.jsx(t,{variant:"subtitle1",gutterBottom:!0,children:"Registro de prestatario"}),e.jsx(t,{variant:"body2",color:"text.secondary",mb:2,children:"Completa los datos del cliente. Se creará el prestatario en la base de datos y un usuario asociado para que pueda iniciar sesión."}),e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Credenciales de acceso"}),e.jsxs(o,{display:"flex",flexDirection:"column",gap:2,mb:3,children:[e.jsx(a,{label:"Nombre de usuario",fullWidth:!0,size:"small",value:i,onChange:r=>p(r.target.value)}),e.jsx(a,{label:"Contraseña",type:"password",fullWidth:!0,size:"small",value:l,onChange:r=>j(r.target.value)}),e.jsx(a,{label:"Confirmar contraseña",type:"password",fullWidth:!0,size:"small",value:n,onChange:r=>b(r.target.value)}),g&&e.jsx(t,{variant:"body2",color:"error",children:g})]}),e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Datos del prestatario"}),e.jsx(oe,{onSubmit:U})]}),s==="form"&&v==="EMPLEADO"&&e.jsxs(o,{component:"form",id:"empleado-registro-form",onSubmit:H(J),children:[e.jsx(t,{variant:"subtitle1",gutterBottom:!0,children:"Registro de empleado"}),e.jsx(t,{variant:"body2",color:"text.secondary",mb:2,children:"Ingresa los datos básicos del empleado. Se creará el empleado en la base de datos y un usuario asociado con rol de empleado."}),e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Credenciales de acceso"}),e.jsxs(o,{display:"flex",flexDirection:"column",gap:2,mb:3,children:[e.jsx(a,{label:"Nombre de usuario",fullWidth:!0,size:"small",value:i,onChange:r=>p(r.target.value)}),e.jsx(a,{label:"Contraseña",type:"password",fullWidth:!0,size:"small",value:l,onChange:r=>j(r.target.value)}),e.jsx(a,{label:"Confirmar contraseña",type:"password",fullWidth:!0,size:"small",value:n,onChange:r=>b(r.target.value)}),g&&e.jsx(t,{variant:"body2",color:"error",children:g})]}),e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Datos del empleado"}),e.jsxs(o,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(a,{label:"Nombre",fullWidth:!0,error:!!f.nombre,helperText:(_=f.nombre)==null?void 0:_.message,...W("nombre",{required:"El nombre es requerido"})}),e.jsx(a,{label:"Apellido",fullWidth:!0,error:!!f.apellido,helperText:(L=f.apellido)==null?void 0:L.message,...W("apellido",{required:"El apellido es requerido"})}),e.jsx(a,{label:"Correo institucional",type:"email",fullWidth:!0,error:!!f.correo,helperText:(I=f.correo)==null?void 0:I.message,...W("correo",{required:"El correo es requerido"})}),e.jsx(a,{label:"Área / dependencia",fullWidth:!0,...W("area")})]})]})]}),e.jsxs(de,{children:[s==="options"&&e.jsx(D,{onClick:E,variant:"contained",color:"primary",children:"Cerrar"}),s==="secret"&&e.jsxs(e.Fragment,{children:[e.jsx(D,{onClick:()=>x("options"),children:"Volver"}),e.jsx(w,{onClick:G,children:"Validar"})]}),s==="form"&&v==="EMPLEADO"&&e.jsxs(e.Fragment,{children:[e.jsx(D,{onClick:E,children:"Cancelar"}),e.jsx(w,{type:"submit",form:"empleado-registro-form",children:"Enviar"})]})]})]})},Se=()=>{var j,n,b,g;const R=$(),v=((n=(j=ee().state)==null?void 0:j.from)==null?void 0:n.pathname)||"/",{login:P,loading:s,error:x}=O(),{t:m}=ae(),[y,C]=u.useState(!1),{register:h,handleSubmit:i,formState:{errors:p}}=M({defaultValues:{username:"",password:""}}),l=async d=>{await P(d),O.getState().token&&R(v,{replace:!0})};return e.jsxs(o,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"grey.100",p:2},children:[e.jsxs(re,{elevation:3,sx:{p:4,maxWidth:400,width:"100%"},children:[e.jsxs(o,{display:"flex",flexDirection:"column",alignItems:"center",mb:3,children:[e.jsx(N,{color:"primary",sx:{fontSize:40}}),e.jsx(t,{variant:"h6",mt:1,children:m("login_title")})]}),e.jsxs(o,{component:"form",onSubmit:i(l),noValidate:!0,children:[e.jsx(a,{margin:"normal",fullWidth:!0,label:m("login_username_label"),autoFocus:!0,error:!!p.username,helperText:(b=p.username)==null?void 0:b.message,...h("username",{required:"El usuario es requerido"})}),e.jsx(a,{margin:"normal",fullWidth:!0,label:m("login_password_label"),type:"password",error:!!p.password,helperText:(g=p.password)==null?void 0:g.message,...h("password",{required:"La contraseña es requerida"})}),x&&e.jsx(t,{color:"error",variant:"body2",mt:1,children:x}),e.jsx(D,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",sx:{mt:2},disabled:s,children:s?e.jsx(te,{size:20,color:"inherit"}):m("login_button")}),e.jsx(o,{mt:2,textAlign:"center",children:e.jsx(t,{variant:"caption",color:"text.secondary",children:m("login_help")})}),e.jsxs(o,{mt:1,textAlign:"center",children:[e.jsx(t,{variant:"body2",color:"text.secondary",mb:1,children:"¿No tienes usuario?"}),e.jsx(D,{variant:"text",size:"small",onClick:()=>C(!0),children:"Registrarme"})]})]})]}),e.jsx(pe,{open:y,onClose:()=>C(!1)})]})};export{Se as LoginPage,Se as default};
