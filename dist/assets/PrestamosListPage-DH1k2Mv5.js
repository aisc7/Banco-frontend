import{i as F,r as $,j as e,c,f as q,h as w,B as r,T as d,I as j,C as L}from"./index--atX_XUv.js";import{d as A}from"./Refresh-Ch8CxwOq.js";import{d as b,a as W}from"./Delete-DmNm5JzK.js";import{A as l}from"./AppButton-DGApZOMm.js";import{A as G}from"./AppTable-CM16yi9f.js";import{u as H,M as J}from"./usePrestamosStore-Bm7nHmuX.js";import{u as K}from"./usePagination-Djf72Sih.js";import{u as Q}from"./useConfirmationDialog-D18w31vS.js";import{a as U,f as D}from"./format-DtUmTUMm.js";import{u as X}from"./useI18n-nd37995H.js";import{T as g}from"./TextField-BTw6FAe8.js";import"./Button-C1kfnTXj.js";import"./prestamosApi-D9fRTWkx.js";var y={},Y=F;Object.defineProperty(y,"__esModule",{value:!0});var S=y.default=void 0,Z=Y($()),ee=e;S=y.default=(0,Z.default)((0,ee.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility");const ae=["","PENDIENTE","ACTIVO","CANCELADO"],he=()=>{const{items:C,prestamosPorPrestatario:v,loading:m,error:u,fetchAll:p,fetchByPrestatario:_,remove:T}=H(),[n,M]=c.useState(""),[t,P]=c.useState(""),f=q(),{t:E}=X(),s=w(a=>a.user),o=(s==null?void 0:s.role)==="EMPLEADO"||(s==null?void 0:s.role)==="ADMIN",I=(s==null?void 0:s.role)==="PRESTATARIO";c.useEffect(()=>{o&&p().catch(()=>{})},[p,o]);const z=c.useMemo(()=>o?C.filter(a=>{const R=!n||a.estado===n,V=!t||String(a.idPrestatario).includes(t);return R&&V}):v,[C,v,n,t,o]),{page:i,totalPages:h,paginatedItems:x,setPage:k}=K(z,10),O=Q(),B=a=>{O.ask("¿Deseas cancelar este préstamo?",()=>{T(a).catch(()=>{})})},N=()=>{t&&_(t).catch(()=>{})};return e.jsxs(r,{children:[e.jsxs(r,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,flexWrap:"wrap",gap:2,children:[e.jsx(d,{variant:"h5",children:I?"Mis préstamos":E("prestamos_title")}),o&&e.jsxs(r,{display:"flex",gap:1,children:[e.jsx(g,{select:!0,size:"small",label:"Estado",value:n,onChange:a=>M(a.target.value),children:ae.map(a=>e.jsx(J,{value:a,children:a||"Todos"},a||"todos"))}),e.jsx(g,{size:"small",label:"ID Prestatario",value:t,onChange:a=>P(a.target.value)}),e.jsx(j,{color:"primary",onClick:()=>p(),children:e.jsx(A,{})}),e.jsx(l,{startIcon:e.jsx(b,{}),onClick:()=>f("/prestamos/nuevo"),children:E("prestamos_new_button")})]}),I&&e.jsxs(r,{display:"flex",gap:1,flexWrap:"wrap",children:[e.jsx(g,{size:"small",label:"Cédula",value:t,onChange:a=>P(a.target.value)}),e.jsx(l,{onClick:N,startIcon:e.jsx(A,{}),children:"Buscar"}),e.jsx(l,{startIcon:e.jsx(b,{}),onClick:()=>f("/prestamos/nuevo"),children:"Solicitar nuevo préstamo"})]})]}),m&&e.jsx(r,{display:"flex",justifyContent:"center",my:4,children:e.jsx(L,{})}),u&&e.jsx(d,{color:"error",mb:2,children:u}),!m&&x.length===0&&!u&&e.jsx(d,{variant:"body2",children:"No hay préstamos para los filtros seleccionados."}),!m&&x.length>0&&e.jsx(G,{columns:[{key:"id",header:"ID"},{key:"idPrestatario",header:"ID Prestatario"},{key:"totalPrestado",header:"Monto",render:a=>U(a.totalPrestado)},{key:"nroCuotas",header:"Cuotas"},{key:"interes",header:"Interés"},{key:"fechaEmision",header:"Emisión",render:a=>D(a.fechaEmision)},{key:"fechaVencimiento",header:"Vencimiento",render:a=>D(a.fechaVencimiento)},{key:"estado",header:"Estado"},{key:"acciones",header:"Acciones",render:a=>e.jsxs(r,{display:"flex",gap:1,children:[e.jsx(j,{size:"small",color:"primary",onClick:()=>f(`/prestamos/${a.id}`),children:e.jsx(S,{fontSize:"small"})}),o&&e.jsx(j,{size:"small",color:"error",onClick:()=>B(a.id),children:e.jsx(W,{fontSize:"small"})})]})}],data:x}),h>1&&e.jsxs(r,{display:"flex",justifyContent:"center",mt:2,gap:1,children:[e.jsx(l,{size:"small",disabled:i<=1,onClick:()=>k(i-1),children:"Anterior"}),e.jsxs(d,{variant:"body2",sx:{alignSelf:"center"},children:["Página ",i," de ",h]}),e.jsx(l,{size:"small",disabled:i>=h,onClick:()=>k(i+1),children:"Siguiente"})]})]})};export{he as PrestamosListPage,he as default};
