import{z as x,c as f,j as t,B as o,T as s}from"./index--atX_XUv.js";import{u as h,d as b}from"./Save-BjSFydXk.js";import{A as j}from"./AppButton-DGApZOMm.js";import{T as e}from"./TextField-BTw6FAe8.js";import"./Button-C1kfnTXj.js";async function g(i){const a=await x.post("/api/auditoria/registrar",i);if(!a.data.ok)throw new Error(a.data.error||"Error al registrar auditoría");return a.data.result}const A=()=>{var n;const[i,a]=f.useState(null),{register:r,handleSubmit:d,reset:c,formState:{errors:l}}=h({defaultValues:{usuario:"",ip:"",dominio:"",tabla:"",operacion:"",descripcion:""}}),p=async u=>{const m=await g(u);a(m.id_audit),c({...u,descripcion:""})};return t.jsxs(o,{children:[t.jsx(s,{variant:"h5",mb:2,children:"Auditoría manual"}),t.jsx(s,{variant:"body2",mb:2,children:"El backend no expone un endpoint para consultar el log completo de auditoría. Esta sección permite registrar manualmente eventos usando los procedimientos existentes."}),t.jsxs(o,{component:"form",onSubmit:d(p),maxWidth:600,display:"flex",flexDirection:"column",gap:2,children:[t.jsx(e,{label:"Usuario",fullWidth:!0,error:!!l.usuario,helperText:(n=l.usuario)==null?void 0:n.message,...r("usuario",{required:"El usuario es requerido"})}),t.jsx(e,{label:"IP",fullWidth:!0,...r("ip")}),t.jsx(e,{label:"Dominio",fullWidth:!0,...r("dominio")}),t.jsx(e,{label:"Tabla afectada",fullWidth:!0,...r("tabla")}),t.jsx(e,{label:"Operación",fullWidth:!0,...r("operacion")}),t.jsx(e,{label:"Descripción",fullWidth:!0,multiline:!0,minRows:2,...r("descripcion")}),t.jsx(o,{display:"flex",justifyContent:"flex-end",gap:1,mt:2,children:t.jsx(j,{startIcon:t.jsx(b,{}),type:"submit",children:"Registrar evento"})})]}),i!==null&&t.jsxs(s,{variant:"body2",mt:2,children:["Último id_audit registrado: ",i]})]})};export{A as AuditoriaPage,A as default};
